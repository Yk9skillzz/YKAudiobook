scanBtn.onclick = async () => {
  const file = fileInput.files[0];
  if (!file) return alert('Please select an image file.');

  const img = new Image();
  img.src = URL.createObjectURL(file);
  await img.decode();

  // Resize only if it's larger than 1000px wide
  const MAX_WIDTH = 1000;
  const scale = img.width > MAX_WIDTH ? MAX_WIDTH / img.width : 1;

  const canvas = document.createElement('canvas');
  canvas.width = img.width * scale;
  canvas.height = img.height * scale;

  const ctx = canvas.getContext('2d');
  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

  const resizedBlob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg'));

  textEl.textContent = '';
  statusEl.textContent = 'Recognizing...';

  const worker = Tesseract.createWorker({
    logger: m => statusEl.textContent = (m.progress * 100).toFixed(1) + '%'
  });

  await worker.load();
  await worker.loadLanguage('eng');
  await worker.initialize('eng');
  const { data: { text } } = await worker.recognize(resizedBlob);
  await worker.terminate();

  recognized = text;
  textEl.textContent = recognized;
  statusEl.textContent = 'Done';
};
